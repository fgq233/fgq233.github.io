###  排他网关、并行网关、包容网关
网关用来控制流程的流向

### 一、排他网关
* 特点：对所有顺序流的条件进行判断，选择`第一个`条件计算为true的顺序流进行后续环节
* 注意
  * 当没有设置条件时，默认顺序流判断结果为true
  * 当有多个顺序流结果为true时，会选择XML中最先定义的顺序流继续流程
  * 如果没有可选的顺序流，会抛出异常

![](https://fgq233.github.io/imgs/workflow/flow08.png)

```
Map<String, Object> var = new HashMap<>();
var.put("num", 2);
taskService.complete("task1_id_......", var);
```

* 如图：两个顺序流条件分别是`${num < 3}、${num >= 3}`
* 当员工请假顺序流在完成任务时，传入网关判断需要的变量，进行结果为`true`的后续环节


### 二、并行网关
* 功能
  * `分支`：将流程分成多条顺序流，多条顺序流并行执行，互不影响
  * `合并`：所有到达并行网关的顺序流都会在网关处等待，直到每一条入口顺序流都到达了，然后流程经过该合并网关继续
* 注意：
  * 如果**一个并行网关**具有多条入口与出口顺序流，可以同时具有分支与合并的行为
  * 并行网关不计算条件，如果连接到并行网关的顺序流上定义了条件，会直接忽略该条件

![](https://fgq233.github.io/imgs/workflow/flow09.png)


* 如图流程，当第一个环节完成后，通过并行网关，产生了 2 个顺序流
  * 任务表`act_ru_task`产生2条记录，2条记录的执行实例`execution_id`不一样
  * 然后在`act_ru_execution`中同时有三条记录，一个任务对应的有两个执行实例
* 当2个顺序流任务都完成后，才会通过第二个并行网关，进行下一环节



### 三、包容网关
* 包括网关类似`排他网关`和`并行网关`的结合
  * 判断：和排他网关一样，可以在连线上定义条件，结果为 true 则进入该顺序流，不设置条件默认为true
  * 分支：流程会计算所有出口顺序流的条件，对于每一条计算为true的顺序流，流程都会创建一个并行执行
  * 合并：所有到达包容网关的并行执行，都会在网关处等待，直到具有流程标志的入口顺序流全部到达，合并后，流程穿过合并并行网关继续
    * 与并行网关区别：包容网关只会等待可以被执行的入口顺序流

![](https://fgq233.github.io/imgs/workflow/flow10.png)


```
Map<String, Object> var = new HashMap<>();
var.put("money", 888);
taskService.complete("task1_id_......", var);
```

* 如图：3个顺序流条件分别是`${money < 1000}、无、${num >= 1000}`
* 当员工采购申请在完成任务时，传入变量money为888，则组长审批、部门经理审批环节产生
  * 任务表`act_ru_task`产生2条记录，2条记录的执行实例`execution_id`不一样
  * 然后在`act_ru_execution`中同时有三条记录，一个任务对应的有两个执行实例
* 当2个顺序流任务都完成后，才会通过第二个包容网关，进行下一环节 - 总经理审批
