### Redis 分片集群
* 主从和哨兵可以解决高可用、高并发读
* 高并发写、海量数据存储的情况下，可以使用分片集群


### 一. 分片集群 
#### 1. 分片集群特征

* 集群中有多个master，每个master保存不同数据

* 每个master都可以有多个slave节点

* master之间通过ping监测彼此健康状态

* 客户端请求可以访问集群任意节点，最终都会被转发到正确节点

![Redis分片集群](https://fgq233.github.io/imgs/springcloud/redis4.png)


#### 2. 散列插槽原理
* Redis会把每一个master节点映射到0~16383共16384个插槽（hash slot）上


* 数据key不是与节点绑定，而是与插槽绑定，redis会根据key的有效部分计算插槽值，分两种情况：

    * key中包含"{}"，且“{}”中至少包含1个字符，“{}”中的部分是有效部分
    * key中不包含“{}”，整个key都是有效部分



 

### 二. 搭建分片集群
略


### 三. Spring Boot 集成分片集群 
#### 1. 引入依赖(同哨兵集群)
#### 2. yml配置Redis地址
```yaml
spring:
  redis:
    cluster:
      nodes:
        - 127.0.0.1:7001
        - 127.0.0.1:7002
        - 127.0.0.1:7003
        - 127.0.0.1:8001
        - 127.0.0.1:8002
        - 127.0.0.1:8003
```

注意：这里配置的是所有 Redis 节点地址

#### 3. 配置读写分离策略(同哨兵集群)

