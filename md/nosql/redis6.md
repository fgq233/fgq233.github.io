### Redis的缓存穿透、击穿、雪崩
三者出现的根本原因：Redis缓存命中率下降，请求到DB上了

### 一. 缓存穿透 
#### 1. 问题
* 查询数据，在数据库没有，自然在缓存中也不会有，这样就导致用户查询的时候，
在缓存中找不到，每次都要去数据库再查询一遍，请求多了以后，导致DB压力过大而卡死或宕机

* 示例： 当大量客户端发出类似：https://localhost/user/666 请求，而DB中没有id=666用户数据，所以Redis中也没有，就会导致这种问题

#### 2. 解决
* 对空值进行缓存，设置一个比较短的过期时间，避免大量无法访问的数据直接请求到DB上
* 对redis进行实时监控，当发现redis中的命中率下降的时候进行原因排查、分析，进一步可以设置黑名单限制，不允许这些请求到达Redis、DB上

 

### 二. 缓存击穿
#### 1. 问题
* redis中的某个热点key过期，但是此时有大量的用户访问该过期key，那么大量高并发该key的请求就会直接到DB服务器上，导致整个DB瘫痪
* 示例：微博上明星出轨事件热搜，大量吃瓜群众访问，此时redis缓存过期，就会出现该问题


#### 2. 解决
* 提前对一些热点数据进行缓存设置
* 监控哪些数据是热门数据，实时的调整key的过期时长
* 使用锁机制：只有一个请求可以获取到互斥锁，然后到DB中将数据查询并返回到Redis，之后所有请求就可以从Redis中得到响应


### 三. 雪崩
#### 1. 问题
* redis中大量缓存采用了相同的过期时间，然后某一时刻集体过期了，导致请求全发到DB上，瞬时压力过大雪崩
* 雪崩是大量过期、击穿是单个过期


#### 2. 解决
* 将缓存失效时间错开：比如在原有失效时间上加随机值，降低集体失效的概率
* 使用多级架构：nginx缓存 + redis缓存 + 其他缓存，不同层使用不同的缓存，可靠性更强




